version : '2'

services:
    nginx:
        build: ../nginx/
        ports:
            - "80:80"
        volumes:
            - /www/static
        volumes_from:
            - django
        links:
            - django:django
         
    django:
        build: 
            context: ../
            dockerfile: Dockerfile.django
        expose:
            - "8000"
        volumes:
            - djangostatic:/usr/src/app/static
            - djangologs:/var/log/django
            - djangomigrations:/djangomigrations
            
        links:
            - postgres:postgres
            - redis:redis
            
        env_file: 
            - .env
        command: uwsgi --ini /usr/src/app/uwsgi.ini
    
    redis:
        image: redis:alpine
        expose:
            - "6379"
     
    postgres:
        image: postgres:9.6-alpine
        expose:
            - "5432"
        volumes:
            - pgdata:/var/lib/postgresql/data/
    
volumes:
    pgdata:
    djangologs:
    djangostatic:
    djangomigrations:
